<!DOCTYPE html>
<html>
<head>
  <title>AI Character Homepage</title>
  <style>
    /* (same styles as before) */
  </style>
</head>
<body>
  <div class="header">
    <div class="left-buttons">
      <button onclick="window.location.href='create.html'">Create A Character</button>
      <button onclick="window.location.href='profile.html'" id="profileBtn" style="display:none;">Go to Profile</button>
      <button onclick="window.location.href='login.html'" id="signInBtn" style="display:none;">Sign In</button>
    </div>
    <div style="display:flex; gap:10px; align-items:center;">
      <button class="right-button" onclick="window.location.href='admin.html'">Admin Login</button>
      <button class="right-button" onclick="signOut()" id="signOutBtn" style="display:none;">Sign Out</button>
    </div>
  </div>

  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Search Characters" oninput="filterCharacters()">
  </div>

  <h2 style="text-align:center">AI Characters</h2>
  <div class="character-grid" id="characterGrid"></div>

  <script>
    let characters = [];

    // Replace with your actual backend URL
    const API_BASE = 'https://ai-character-backend.onrender.com';

    async function fetchCharacters() {
      try {
        const res = await fetch(`${API_BASE}/api/characters`);
        characters = await res.json();
        renderCharacters();
      } catch (err) {
        console.error("Failed to load characters", err);
      }
    }

    function renderCharacters(filtered = characters) {
      const grid = document.getElementById("characterGrid");
      grid.innerHTML = "";
      filtered.forEach(char => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <img src="${char.image}" alt="${char.name}">
          <h3>${char.name}</h3>
          <button onclick="location.href='chat.html?name=${encodeURIComponent(char.name)}'">Chat Now</button>
        `;
        grid.appendChild(div);
      });
    }

    function filterCharacters() {
      const query = document.getElementById("searchInput").value.toLowerCase();
      const filtered = characters.filter(char =>
        char.name.toLowerCase().includes(query)
      );
      renderCharacters(filtered);
    }

    function signOut() {
      fetch(`${API_BASE}/api/users/logout`, { method: 'POST', credentials: 'include' })
        .then(() => location.reload())
        .catch(err => console.error("Logout failed", err));
    }

    // Show buttons based on session (optional if using cookies)
    fetch(`${API_BASE}/api/users/me`, { credentials: 'include' })
      .then(res => res.ok ? res.json() : null)
      .then(user => {
        if (user) {
          document.getElementById("profileBtn").style.display = "inline-block";
          document.getElementById("signOutBtn").style.display = "inline-block";
        } else {
          document.getElementById("signInBtn").style.display = "inline-block";
        }
      });

    fetchCharacters();
  </script>
</body>
</html>
