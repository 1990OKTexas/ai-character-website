<script>
  const API_BASE = 'https://ai-character-backend.onrender.com';

  const profilePicURL = document.getElementById("profilePic");
  const profilePicFile = document.getElementById("profilePicFile");
  const preview = document.getElementById("picPreview");

  profilePicURL.addEventListener("input", () => {
    if (profilePicURL.value) {
      preview.src = profilePicURL.value;
      profilePicFile.value = "";
    }
  });

  profilePicFile.addEventListener("change", () => {
    const file = profilePicFile.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = e => preview.src = e.target.result;
      reader.readAsDataURL(file);
      profilePicURL.value = "";
    }
  });

  function handleSignup() {
    const nickname = document.getElementById("nickname").value.trim();
    const sex = document.getElementById("sex").value;
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value;
    const confirmPassword = document.getElementById("confirmPassword").value;
    const profilePic = preview.src;

    if (!nickname || !username || !password || !confirmPassword) {
      alert("Please fill in all fields.");
      return;
    }

    if (password !== confirmPassword) {
      alert("Your passwords don't match, Uce. Try again.");
      return;
    }

    fetch(`${API_BASE}/api/users/signup`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      credentials: "include",
      body: JSON.stringify({
        nickname,
        sex,
        username,
        password,
        profilePic
      })
    })
    .then(res => {
      if (!res.ok) throw new Error("Signup failed");
      return res.json();
    })
    .then(() => {
      alert("Account created! Youâ€™re now signed in.");
      window.location.href = "index.html";
    })
    .catch(err => {
      alert("That username is already taken, Uce.");
    });
  }
</script>
