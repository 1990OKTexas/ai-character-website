<script>
  const API_BASE = 'https://ai-character-backend.onrender.com';

  async function saveKey() {
    const key = document.getElementById("apiKeyInput").value.trim();
    const msg = document.getElementById("msg");

    msg.textContent = "";
    msg.className = "msg";

    if (!key.startsWith("gsk_")) {
      msg.textContent = "Invalid Groq API Key";
      msg.classList.add("error");
      return;
    }

    try {
      const res = await fetch(`${API_BASE}/api/users/key`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        body: JSON.stringify({ groqKey: key })
      });

      if (res.ok) {
        msg.textContent = "API Key Saved!";
        msg.classList.add("success");
      } else {
        msg.textContent = "Failed to save key.";
        msg.classList.add("error");
      }
    } catch (err) {
      msg.textContent = "Error saving key.";
      msg.classList.add("error");
    }
  }
</script>
