<!DOCTYPE html>
<html>
  <head>
    <title>Admin Panel</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f0f0f0;
      }
      .login-box, .admin-panel {
        max-width: 500px;
        margin: 40px auto;
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 0 8px rgba(0,0,0,0.1);
      }
      input {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        font-size: 14px;
        border-radius: 6px;
        border: 1px solid #ccc;
      }
      button {
        width: 100%;
        margin-top: 16px;
        padding: 10px;
        font-size: 14px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }
      h2 {
        text-align: center;
      }
      h3 {
        margin-top: 30px;
      }
      .character-card {
        background: #fff;
        padding: 10px;
        margin: 10px 0;
        border-radius: 8px;
        border: 1px solid #ccc;
      }
      .character-card button {
        background: #dc3545;
        font-size: 13px;
        padding: 6px 10px;
        margin-top: 6px;
      }
      .logout {
        background: #6c757d;
        margin-top: 30px;
      }
    </style>
  </head>
  <body>

    <div id="loginBox" class="login-box">
      <h2>Admin Login</h2>
      <input type="text" id="adminUser" placeholder="Username" />
      <input type="password" id="adminPass" placeholder="Password" />
      <button onclick="checkLogin()">Login</button>
    </div>

    <div id="adminPanel" class="admin-panel" style="display:none;">
      <h2>Welcome, Admin</h2>

      <h3>Characters</h3>
      <div class="character-list" id="characterList"></div>

      <h3>Users</h3>
      <div class="character-list" id="userList"></div>

      <button class="logout" onclick="logout()">Log Out</button>
    </div>

    <script>
      const ADMIN_USERNAME = "admin";
      const ADMIN_PASSWORD = "ucegang";

      function checkLogin() {
        const user = document.getElementById("adminUser").value.trim();
        const pass = document.getElementById("adminPass").value.trim();
        if (user === ADMIN_USERNAME && pass === ADMIN_PASSWORD) {
          localStorage.setItem("adminLoggedIn", "true");
          showPanel();
        } else {
          alert("Wrong username or password, Uce.");
        }
      }

      function showPanel() {
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
        loadCharacters();
        loadUsers();
      }

      function logout() {
        localStorage.removeItem("adminLoggedIn");
        location.reload();
      }

      function loadCharacters() {
        const list = document.getElementById("characterList");
        list.innerHTML = "";
        const characters = JSON.parse(localStorage.getItem("characters") || "[]");

        if (characters.length === 0) {
          list.innerHTML = "<p>No characters found.</p>";
          return;
        }

        characters.forEach((char, index) => {
          const div = document.createElement("div");
          div.className = "character-card";
          div.innerHTML = `
            <strong>${char.name}</strong><br />
            ${char.description}<br />
            <button onclick="deleteCharacter(${index})">Delete Character</button>
          `;
          list.appendChild(div);
        });
      }

      function deleteCharacter(index) {
        if (!confirm("Are you sure you want to delete this character?")) return;
        const characters = JSON.parse(localStorage.getItem("characters") || "[]");
        characters.splice(index, 1);
        localStorage.setItem("characters", JSON.stringify(characters));
        loadCharacters();
      }

      function loadUsers() {
        const userList = document.getElementById("userList");
        userList.innerHTML = "";
        const users = JSON.parse(localStorage.getItem("users") || "[]");

        if (users.length === 0) {
          userList.innerHTML = "<p>No users registered.</p>";
          return;
        }

        users.forEach((user, index) => {
          const div = document.createElement("div");
          div.className = "character-card";
          div.innerHTML = `
            <strong>@${user.username}</strong> (${user.nickname}, ${user.sex})<br />
            <button onclick="deleteUser(${index})">Delete User</button>
          `;
          userList.appendChild(div);
        });
      }

      function deleteUser(index) {
        if (!confirm("Delete this user?")) return;
        const users = JSON.parse(localStorage.getItem("users") || "[]");
        const updatedUsers = [...users];
        const deletedUser = updatedUsers.splice(index, 1)[0];
        localStorage.setItem("users", JSON.stringify(updatedUsers));

        // Remove their session if currently logged in
        const currentUser = JSON.parse(localStorage.getItem("loggedInUser"));
        if (currentUser && currentUser.username === deletedUser.username) {
          localStorage.removeItem("loggedInUser");
        }

        loadUsers();
      }

      if (localStorage.getItem("adminLoggedIn") === "true") {
        showPanel();
      }
    </script>
  </body>
</html>
